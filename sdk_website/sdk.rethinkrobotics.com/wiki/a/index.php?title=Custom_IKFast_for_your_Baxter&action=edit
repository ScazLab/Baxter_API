<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>View source for Custom IKFast for your Baxter - sdk-wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Custom_IKFast_for_your_Baxter","wgTitle":"Custom IKFast for your Baxter","wgCurRevisionId":4198,"wgRevisionId":0,"wgArticleId":809,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Custom_IKFast_for_your_Baxter","wgRelevantArticleId":809,"wgRequestId":"102683dff00f86486f4de626","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready"});mw.loader.implement("user.tokens@01doy7a",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.cavendishmw-rethinkrobotics"]);});</script>
<link rel="stylesheet" href="load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cmediawiki.sectionAnchor&amp;only=styles&amp;skin=cavendishmw-rethinkrobotics"/>
<script async="" src="load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=cavendishmw-rethinkrobotics"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=cavendishmw-rethinkrobotics"/>
<meta name="generator" content="MediaWiki 1.31.0"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="shortcut icon" href="../../favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://sdk.rethinkrobotics.com/wiki/a/opensearch_desc.php" title="sdk-wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://sdk.rethinkrobotics.com/wiki/a/api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="sdk-wiki Atom feed" href="http://sdk.rethinkrobotics.com/wiki/a/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/wiki/a/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=cavendishmw-rethinkrobotics&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Custom_IKFast_for_your_Baxter rootpage-Custom_IKFast_for_your_Baxter skin-cavendishmw-rethinkrobotics action-edit"><div id="container"><!-- start fragment header -->
    <!-- <div id="mozilla-org"><a href="#">Mozilla Skin</a></div> -->
    <div id="header" class="noprint">
        <a name="top" id="contentTop"></a>

        <!-- Logo + site name -->
        <h1>
            <a href="../../wiki" style="text-indent: 2em; width: 194px; height: 67px; background: transparent url(skins/cavendishmw-rethinkrobotics/styles/images/header_logo.png) no-repeat scroll 5px -5px;" title="Visit the main page">&nbsp;</a>        </h1>

	<div id="rr_ActionWrap">
	<!-- Account action links -->
	<div id="accountActions"><a href="http://sdk-accounts.rethinkrobotics.com/public/NewUser">Create account</a><a href="http://sdk.rethinkrobotics.com/wiki/a/index.php?title=Special:UserLogin&amp;returnto=Custom+IKFast+for+your+Baxter&amp;returntoquery=action%3Dedit">Log in</a></div>
        <!-- Search box -->
            <form action="http://sdk.rethinkrobotics.com/wiki/a/index.php" id="searchform">
        <label for="searchInput">Search</label>
        <input type='hidden' name="title" value="Special:Search"/>
        <input type="search" name="search" placeholder="Search sdk-wiki" title="Search sdk-wiki [f]" accesskey="f" id="searchInput"/>
        &#160;
        <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"/>    </form>
	</div>
    </div> <!-- End header div -->
<!-- end fragment header --><div id="mBody"><!-- start fragment mainContent -->
<!-- start fragment firstHeader -->
<div id="firstHeadingDiv" class="firstHeading">
    <h1 lang="en"><span dir="auto">View source for Custom IKFast for your Baxter</span></h1>


        <!-- Content action buttons -->
        <ul><li><a href="index.php?title=Custom_IKFast_for_your_Baxter&amp;action=edit#">More</a><ul><li id="ca-viewsource" class="selected"><a href="index.php?title=Custom_IKFast_for_your_Baxter&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li id="ca-history"><a href="index.php?title=Custom_IKFast_for_your_Baxter&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li></ul></li><li id="ca-nstab-main" class="selected"><a href="../Custom_IKFast_for_your_Baxter" title="View the content page [c]" accesskey="c">Page</a></li></ul>
</div><!-- end fragment firstHeader --><!-- start fragment sidebar -->        <div id="side" class="noprint" > <!-- cavendishmw: s/column-one/side/ -->
            <ul id="nav">
                      <li><span>Navigation</span>
            <ul>
                <li id="n-Getting-Started"><a href="../Getting_Started">Getting Started</a></li>
                <li id="n-Learning"><a href="../Learning">Learning</a></li>
                <li id="n-Community"><a href="../Community">Community</a></li>
                <li id="n-Support"><a href="../Support">Support</a></li>
            </ul>
        </li>
      <li><span>Links</span>
            <ul class="collapsible-collapsed">
                <li id="n-Forum"><a href="https://groups.google.com/a/rethinkrobotics.com/forum/#!forum/brr-users" rel="nofollow">Forum</a></li>
                <li id="n-Source"><a href="https://github.com/RethinkRobotics" rel="nofollow">Source</a></li>
                <li id="n-Source-API"><a href="http://api.rethinkrobotics.com/" rel="nofollow">Source API</a></li>
            </ul>
        </li>
      <li><span>Tools</span>
            <ul class="collapsible-collapsed">
                <li id="n-All-Pages"><a href="../Special:AllPages">All Pages</a></li>
                <li id="n-Upload-File"><a href="../Special:Upload">Upload File</a></li>
                <li id="n-What-Links-Here.3F"><a href="../Special:WhatLinksHere">What Links Here?</a></li>
            </ul>
        </li>
            </ul> <!-- /nav -->
        </div> <!-- /side -->
<!-- end fragment sidebar -->
<div id="mainContent"> <!-- cavendishmw: s/column-content/mainContent/ -->
    
  <div id="bodyContent" class="mw-body">
    <div id="siteSub">From sdk-wiki</div>
    <div id="contentSub">‚Üê <a href="../Custom_IKFast_for_your_Baxter" title="Custom IKFast for your Baxter">Custom IKFast for your Baxter</a></div>
    <div id="jump-to-nav" class="mw-jump">Jump to: <a href="index.php?title=Custom_IKFast_for_your_Baxter&amp;action=edit#column-one">navigation</a>, <a href="index.php?title=Custom_IKFast_for_your_Baxter&amp;action=edit#searchInput">search</a></div>
    
  <!-- start content -->
  <div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://sdk.rethinkrobotics.com/wiki/a/index.php?title=Sdk-wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Sdk-wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" class="mw-editfont-monospace" lang="en" dir="ltr" name="wpTextbox1">== Overview ==
Every Baxter's URDF is slightly different. This tutorial will show you how to generate IKFast for use with [http://moveit.ros.org/wiki/Kinematics/IKFast MoveIt] specific to your Baxter. This is a fairly involved process, requiring many steps. For additional background information on the algorithm behind IKFast, please see [http://www.programmingvision.com/rosen_diankov_thesis.pdf Rosen Diankov's Doctoral thesis]. Another really good tutorial for generating IKFast for generic (non-Baxter) robots can be found on MoveIt's website: http://moveit.ros.org/wiki/Kinematics/IKFast

=== What is IKFast? ===
[[#ikfast IKFast]] provides analytical closed-form solutions for manipulator inverse kinematics. Part of the [http://openrave.org/ OpenRAVE] robot architecture/software framework, IKFast has been used to provide closed-form solutions for Baxter's inverse kinematics. Advantages include '''order of magnitude''' faster IK solutions and the ability explore the manipulator's null space!

=== Using Baxter's MoveIt! IKFast plugins ===
Please see [[MoveIt_Tutorial#IKFast]] for the exact commands required to enable IKFast in your baxter_moveit_config package.

== Generating Custom IKFast for Baxter ==

=== Install OpenRAVE ===
As of this writing, the [http://www.openrave.org/docs/latest_stable/install/#install instructions for adding the openrave PPA and installing openrave debians] does not work on Ubuntu Trusty since the [https://launchpad.net/~openrave/+archive/ubuntu/release latest release was created in 2012 for Precise]. That leaves building from source as the only option. Please clone the [https://github.com/rdiankov/openrave OpenRAVE repo] and follow [http://www.openrave.org/docs/latest_stable/coreapihtml/installation_linux.html#Building_OpenRAVE this tutorial for building from source]:&lt;br/>
  &lt;code>git clone --branch latest_stable https://github.com/rdiankov/openrave.git&lt;/code>
If you encounter any issues in building this repo, please let the developers know in the [https://github.com/rdiankov/openrave/issues issues tab of their repo].

=== Clone the baxter_custom_ikfast Repository ===
To create IKFast for Baxter, we need to break him down into her individual arms. For this tutorial, we split Baxter into left and right arm URDFs and then removed any link/joint not in the kinematic chain between the base and end-effector. The result of this is a simple little repository on GitHub with these split URDFs in their generic form. Clone the &lt;code>baxter_custom_ikfast&lt;/code> repo anywhere, but make sure you are inside a [[RSDK_Shell | initialized baxter.sh shell]] for commands later on.
&lt;source lang="bash">
$ git clone https://github.com/RethinkRobotics/baxter_custom_ikfast.git
&lt;/source>
Navigate inside this cloned folder for the rest of this tutorial:
&lt;source lang="bash">
$ cd custom_baxter_ikfast
&lt;/source>

=== Extracting the Mount Joint Transform ===
The left and right arm mount joint's in Baxter's torso are hand-welded at manufacture time. These joints are carefully measured and the transforms are stored in your Baxter's torso joint board. Fortunately, we can see the transforms in your robot's URDF located in the /robot_description parameter on the param server. After a fresh boot (to ensure the custom URDF has not been overwritten), from a [[RSDK_Shell | properly initialized]] Baxter environment, export the URDF from the &lt;code>/robot_description&lt;/code> parameter on the ROS parameter server where it is stored, to a file of your choice (ex: &lt;code>baxter_urdf.xml&lt;/code>):

&lt;source lang="bash">
$ rosparam get -p /robot_description | tail -n +2 > baxter_urdf.xml
&lt;/source>

The &lt;code>-p&lt;/code> outputs the parameter using pretty print.  The output urdf is piped through the &lt;code>tail&lt;/code> command first to remove a dummy first line - an artifact of the pretty print.  

&lt;br/>

Open &lt;code>baxter_urdf.xml&lt;/code> in your favorite text editor, and search for &lt;code>torso_arm_mount&lt;/code> to which are the '''only joints''' that differ from Baxter to Baxter. This is an example of what you should expect if the robot description contains Baxter's custom joints:
&lt;source lang="xml">
&lt;joint name="left_torso_arm_mount" type="fixed">
    &lt;origin xyz="0.0229088 0.220982 0.106714" rpy="-0.0179406 0.0117677 0.786034" />
    &lt;axis xyz="0 0 0" />
    &lt;parent link="torso" />
    &lt;child link="left_arm_mount" />
&lt;/joint>
&lt;/source>
and
&lt;source lang="xml">
&lt;joint name="right_torso_arm_mount" type="fixed">
    &lt;origin xyz="0.0245182 -0.218624 0.10866" rpy="-0.00321838 -0.00564277 -0.78571" />
    &lt;axis xyz="0 0 0" />
    &lt;parent link="torso" />
    &lt;child link="right_arm_mount" />
&lt;/joint>
&lt;/source>
*'''Note:''' Save '''just the origin''' transform snippits of URDF for the next step. Be sure to avoid copying the '''parent link''' value '''torso''' as IKFast optimizes it out due to it being an identity transform and replaces it with '''base'''.

&lt;br/>
*'''Note:''' If you see the following joint values, then you are using the [https://github.com/RethinkRobotics/baxter_common/blob/master/baxter_description/urdf/baxter.urdf generic URDF] provided in &lt;code>baxter_description&lt;/code> of the SDK. This can happen if the generic URDF is loaded to the param server via a &lt;code>roslaunch&lt;/code> script (such as the one with MoveIt). Reboot your robot to clear the &lt;code>robot_description&lt;/code> and try again:

&lt;source lang="xml">
    &lt;joint name="left_torso_arm_mount" type="fixed">
        &lt;origin rpy="0 0 0.7854" xyz="0.024645 0.219645 0.118588"/>
        &lt;parent link="torso"/>
        &lt;child link="left_arm_mount"/>
    &lt;/joint>
&lt;/source>

&lt;source lang="xml">
    &lt;joint name="right_torso_arm_mount" type="fixed">
        &lt;origin rpy="0 0 -0.7854" xyz="0.024645 -0.219645 0.118588"/>
        &lt;parent link="torso"/>
        &lt;child link="right_arm_mount"/>
    &lt;/joint>
&lt;/source>

=== Modify Simplified URDFs with your robot's joints ===
The &lt;code>baxter_arm.accurate.&lt;side>.urdf&lt;/code> was extracted from Baxter's original urdf to separate out the left and right arms. Inside the &lt;code>baxter_custom_ikfast&lt;/code> folder, edit both &lt;code>baxter_arm.accurate.&lt;side>.urdf&lt;/code>'s with your favorite text editor:&lt;br/>
Replace the '''origin''' tag with your copied transform values inside the '''&lt;side>_torso_arm_mount''' joints:
&lt;source lang="bash">
  &lt;joint name="left_torso_arm_mount" type="fixed">
    &lt;origin rpy="0 0 0.7854" xyz="0.024645 0.219645 0.118588"/>
    &lt;parent link="base"/>
    &lt;child link="left_arm_mount"/>
  &lt;/joint>
&lt;/source>
Save, quit, and repeat for the other arm's urdf.

=== Create DAEs for Each Arm ===
Create our DAEs for each arm:&lt;br/>
&lt;source lang="bash">
sudo apt-get install ros-indigo-robot-model
&lt;/source>

* '''Note:''' Please use the a simplified version of the urdf to only contain each manipulators links/joints modified with your robot's arm mount joint extracted above &lt;br/>
&lt;source lang="bash">
rosrun collada_urdf urdf_to_collada baxter_arm.accurate.right.urdf baxter_arm.right.dae
&lt;/source>

* '''Note:''' The resulting DAE also needs some tuning - specifically the rotational portions of the description. &lt;br/>Specifically, we will need to round values logically (ie. 119.9999999999999 to 120.0) This will be addressed in the next step.
&lt;br/>
Please take note of the link indices using the following command:
&lt;pre>
$ openrave0.9-robot.py baxter_arm.right.dae --info links
name                 index parents             
-----------------------------------------------
base                 0                         
right_arm_mount      1     base                
right_upper_shoulder 2     right_arm_mount     
right_lower_shoulder 3     right_upper_shoulder
right_upper_elbow    4     right_lower_shoulder
right_lower_elbow    5     right_upper_elbow   
right_upper_forearm  6     right_lower_elbow   
right_lower_forearm  7     right_upper_forearm 
right_wrist          8     right_lower_forearm 
right_hand           9     right_wrist         
right_gripper        10    right_hand          
-----------------------------------------------
name                 index parents   
&lt;/pre>
Likewise with the joints:
&lt;pre>
$ openrave0.9-robot.py baxter_arm.right.dae --info joints
name                  joint_index dof_index parent_link          child_link           mimic
-------------------------------------------------------------------------------------------
right_s0              0           0         right_arm_mount      right_upper_shoulder      
right_s1              1           1         right_upper_shoulder right_lower_shoulder      
right_e0              2           2         right_lower_shoulder right_upper_elbow         
right_e1              3           3         right_upper_elbow    right_lower_elbow         
right_w0              4           4         right_lower_elbow    right_upper_forearm       
right_w1              5           5         right_upper_forearm  right_lower_forearm       
right_w2              6           6         right_lower_forearm  right_wrist               
right_torso_arm_mount -1          -1        base                 right_arm_mount           
right_hand            -1          -1        right_wrist          right_hand                
right_endpoint        -1          -1        right_hand           right_gripper             
-------------------------------------------------------------------------------------------
name                  joint_index dof_index parent_link          child_link           mimic
&lt;/pre>

=== Rounding DAEs for Each Arm ===
The openrave solver takes a lot longer to calculate solutions with many decimal points inside the numbers of the DAE files. To remedy this, download moveit_ikfast:&lt;br/>
&lt;source lang="bash">
$ sudo apt-get install ros-indigo-moveit-ikfast
&lt;/source>
Let's round the numbers to five decimal points:
&lt;source lang="bash">
$ rosrun moveit_ikfast round_collada_numbers.py baxter_arm.right.dae baxter_arm.right.rounded.dae 5
&lt;/source>

=== Choose IK Type ===
Choose your IK Type (ex: Transform6D, Rotation3d, Translation3D, etc.)&lt;br/>
http://openrave.org/docs/latest_stable/openravepy/ikfast/#ik-types&lt;br/>
For most applications it makes sense to use transform6D - Baxter's end effector reaches desired 6D transformation&lt;br/>

=== Generate the IKFast Solver ===
Building the solver using the collada mesh, chosen iktype, base, and end effector links created and found in the previous steps.
&lt;source lang="bash">
$ python /path_to_openrave/openrave/python/ikfast.py --robot=baxter_arm.right.rounded.dae --iktype=transform6d --baselink=1 --eelink=10 --freeindex=5 --savefile=baxter_right_arm_ikfast_solver.cpp
&lt;/source>
Completion time should be ~24 minutes.
&lt;br/>
This library is what exists inside the official [https://github.com/ros-planning/moveit_robots/blob/master/baxter/baxter_ikfast_right_arm_plugin/src/baxter_right_arm_ikfast_solver.cpp moveit_robots/baxter_ikfast_&lt;side>_arm_plugin package]. &lt;br/>
Simply drop this cpp file in there, rebuild your catkin workspace, and enable IKFast as explained in [[MoveIt_Tutorial#IKFast]].
&lt;br/>&lt;br/>
Congrats! You've created a custom IKFast for your Baxter!&lt;br/>

=== Testing with the IKFastDemo ===
If you'd like to explore IKFast a bit further, you can compile the source code into an executable
&lt;source lang="bash">
$ g++ -lstdc++ -o  baxter_right_ik baxter_right_arm_ikfast_solver.cpp -llapack
&lt;/source>
&lt;br/>
And finally, to go even further by testing out the ikfastdemo, first download it from the kaist-ros-pkg with wget:
&lt;source lang="bash">
$ wget http://kaist-ros-pkg.googlecode.com/svn/trunk/arm_kinematics_tools/src/ikfastdemo/ikfastdemo.cpp
&lt;/source> 
Then edit the &lt;code>ikfastdemo.cpp&lt;/code> source file in your favorite text editor. &lt;br/>
Modify the following lines at the top of the file:
&lt;source lang="c">
#define IK_VERSION 61
#include "baxter_right_arm_ikfast_solver.cpp"
&lt;/source>
Then compile your IKFastDemo:
&lt;source lang="bash">
$ g++ ikfastdemo.cpp -lstdc++ -llapack -o compute -lrt
&lt;/source>
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="../Custom_IKFast_for_your_Baxter" title="Custom IKFast for your Baxter">Custom IKFast for your Baxter</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="../Custom_IKFast_for_your_Baxter">http://sdk.rethinkrobotics.com/wiki/Custom_IKFast_for_your_Baxter</a>"</div>
  <div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>  <!-- end content -->
  
    <div class="visualClear"></div>
</div>
</div> <!-- /mainContent -->
<!-- end fragment mainContent --></div> <!-- /mBody --><div class="visualClear"></div><!-- start fragment footer -->    <div id="footer" role="contentinfo">
        <div id="f-poweredbyico">
                <a href="http://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/a/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/a/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>
            </div>
        <ul id="f-list">
                <li id="copywrite_notice">&copy; 2015 Rethink Robotics. All rights reserved.</li>
                <li id="special_pages"><a href="../Special:SpecialPages" title="Special:SpecialPages">SpecialPages</a></li>
                <li id="privacy"><a href="../Sdk-wiki:Privacy_policy" title="Sdk-wiki:Privacy policy">Privacy policy</a></li>
                <li id="about"><a href="../Sdk-wiki:About" title="Sdk-wiki:About">About sdk-wiki</a></li>
                <li id="disclaimer"><a href="../Sdk-wiki:General_disclaimer" title="Sdk-wiki:General disclaimer">Disclaimers</a></li>
            </ul>
    </div><!-- end fragment footer --></div><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":80});});</script></body></html>